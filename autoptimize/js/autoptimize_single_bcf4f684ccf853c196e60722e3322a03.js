jQuery(document).ready(function($){$('#event_date').on('change',function(e){e.preventDefault();var selected_distance=$('#event_distance').val();var selected_date=$('#event_date').val();localStorage.setItem('month',selected_date);var path=window.location.pathname;$('#events').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'filter_posts',afp_nonce:afp_vars.afp_nonce,distance:selected_distance,date:selected_date,taxonomy:$('#slug').val()};$.post(afp_vars.afp_ajax_url,data,function(response){$('#events').html(response);$('#events').fadeIn();resizeImageContent();});},500);});$('#event_distance').on('change',function(e){e.preventDefault();var selected_distance=$('#event_distance').val();var selected_date=$('#event_date').val();var path=window.location.pathname;$('#events').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'filter_posts',afp_nonce:afp_vars.afp_nonce,distance:selected_distance,date:selected_date,taxonomy:$('#slug').val()};$.post(afp_vars.afp_ajax_url,data,function(response){$('#events').html(response);$('#events').fadeIn();resizeImageContent();});},500);});$('#event_category').on('change',function(e){e.preventDefault();var category=$('#event_category').val();var path=window.location.pathname;$('#events').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');data={action:'filter_events',afp_nonce:afp_vars.afp_nonce,category:category,};$.post(afp_vars.afp_ajax_url,data,function(response){$('#events').html(response);$('#events').fadeIn();resizeImageContent();});});var page=1;$('.research-project-filter-ajax').on('change',function(e){e.preventDefault();var selected_type=$('#cancerType').val();var selected_status=$('#projectStatus').val();var taxonomy=$('#slug').val();$('#projects').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'fetch_projects',afp_nonce:afp_vars.afp_nonce,cancerType:selected_type,status:selected_status,taxonomy:taxonomy,offset:0};$.post(afp_vars.afp_ajax_url,data,function(response){page=1;$("#more_project").show();$('#projects').html(response);$('#projects').fadeIn();resizeImageContent();});},500);data={taxonomy:taxonomy};$("#more_project").show();if(selected_type===''){location.reload();}});$('#more_project').on('click',function(e){e.preventDefault();var selected_type=$('#cancerType').val();var taxonomy=$('#slug').val();data={action:'fetch_projects',afp_nonce:afp_vars.afp_nonce,cancerType:selected_type,taxonomy:taxonomy,offset:(page*6)+1};$.post(afp_vars.afp_ajax_url,data,function(response){if(response!=0){page++;$('#projects').append(response);resizeImageContent();}else{$("#more_project").hide();}});});$('.story-filter-ajax').on('change',function(e){e.preventDefault();var selected_type=$('#cancerType').val();var taxonomy=$('#slug').val();$('#stories').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'fetch_stories',afp_nonce:afp_vars.afp_nonce,cancerType:selected_type,taxonomy:taxonomy,offset:0};$.post(afp_vars.afp_ajax_url,data,function(response){page=1;$("#more_stories_cat").show();$('#stories').html(response);$('#stories').fadeIn();resizeImageContent();});if(selected_type===''){location.reload();}},500);});$('.story-cat-filter-ajax').on('change',function(e){e.preventDefault();var selected_cat=$('#storyCat').val();var taxonomy='story-category';$('#stories').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'fetch_stories_cat',afp_nonce:afp_vars.afp_nonce,category:selected_cat,taxonomy:taxonomy,offset:0};$.post(afp_vars.afp_ajax_url,data,function(response){page=1;$("#more_stories").show();$('#stories').html(response);$('#stories').fadeIn();resizeImageContent();});},500);});function checkFiltersFromURL(){let urlParams=new URLSearchParams(window.location.search);let filterParams=urlParams.getAll('filter');let cancerType=urlParams.get('cancerType');let hasFilters=filterParams.length>0||cancerType!==null;filterParams.forEach(function(param){$('input[name="storyCategory"][value="'+param+'"]').prop('checked',true);});if(cancerType){$('#cancerType').val(cancerType);}else{$('#cancerType').val('');}
if(hasFilters){fetchStories();}}
function updateURLParams(selectedCategories,selectedType){let url=new URL(window.location.href);url.searchParams.delete('filter');url.searchParams.delete('cancerType');selectedCategories.forEach(function(category){url.searchParams.append('filter',category);});if(selectedType&&selectedType!==''){url.searchParams.set('cancerType',selectedType);}
window.history.pushState({},'',url);}
function fetchStories(){let selectedType=$('#cancerType').val();let selectedCategories=[];$('input[name="storyCategory"]:checked').each(function(){selectedCategories.push($(this).val());});updateURLParams(selectedCategories,selectedType);$('#stories').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){$.ajax({url:afp_vars.afp_ajax_url,type:'POST',data:{action:'fetch_stories_combined',cancerType:selectedType,storyCategory:selectedCategories,afp_nonce:afp_vars.afp_nonce},success:function(data){$("#more_stories").show();$('#stories').html(data).fadeIn();resizeImageContent();$('input[name="storyCategory"]').attr('disabled',false);},error:function(jqXHR,textStatus,errorThrown){console.log('AJAX error: '+textStatus+' : '+errorThrown);$('#stories').html('<p>Error loading stories.</p>');}});},500);}
$(document).ready(function(){checkFiltersFromURL();$('input[name="storyCategory"]').on('change',function(){if($(this).is(':disabled')){return;}
$('input[name="storyCategory"]').attr('disabled',true);if($(this).is(':checked')){$('input[name="storyCategory"]').not(this).prop('checked',false);}
fetchStories();});$('#cancerType').on('change',function(){fetchStories();});});$('#story-pagination').on('click','#pagination a',function(e){e.preventDefault();if($(this).hasClass('prev')||$(this).hasClass('next')){paginateNum=$(this).find('.prev-next').data('attr');post_filter(paginateNum);}
else{paginateNum=$(this).text();post_filter(paginateNum);}
$("html, body").animate({scrollTop:0},"slow");});$('#more_stories_cat').on('click',function(e){e.preventDefault();var cancer_type=$('#cancerType').val();var taxonomy=$('#slug').length?$('#slug').val():'story-category';var action=$('#slug').length?'fetch_stories':'fetch_stories_cat'
data={action:action,afp_nonce:afp_vars.afp_nonce,cancerType:cancer_type,taxonomy:taxonomy,offset:(page*6)+1};$.post(afp_vars.afp_ajax_url,data,function(response){if(response!=0){page++;$('#stories').append(response);resizeImageContent();}else{$("#more_stories_cat").hide();}});});$('.welfare-filter-ajax').on('change',function(e){e.preventDefault();var selected_status=$('#welfare_projects').val();$('#welfareProjects').html('<i style="display:block;margin:50px auto 800px auto;" class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>');setTimeout(function(){data={action:'fetch_welfare_projects',afp_nonce:afp_vars.afp_nonce,status:selected_status,};$.post(afp_vars.afp_ajax_url,data,function(response){$('#welfareProjects').html(response);resizeImageContent();});},500);});$('#more_welfare_projects').on('click',function(e){e.preventDefault();var selected_status=$('#welfare_projects').val();data={action:'fetch_welfare_projects',afp_nonce:afp_vars.afp_nonce,status:selected_status,offset:(page*6)+1};$.post(afp_vars.afp_ajax_url,data,function(response){if(response!=0){page++;$('#welfareProjects').append(response);resizeImageContent();}else{$("#more_welfare_projects").hide();}});});});function resizeImageContent(){$('.image-content').each(function(){var height=0;$(this).find('.resize').each(function(){height=$(this).height()>height?$(this).height():height;});$(this).find('.resize').height(Math.round(height)+'px');});}
jQuery(function($){$(".gform_wrapper form").submit(function(event){$(".gform_button",this).html("<span>Processing, please wait...</span>");});});